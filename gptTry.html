<!DOCTYPE html>
<html>
  <head>
    <title>AR.js with Three.js</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
  </head>
  <body style='margin : 0px; overflow: hidden;'>
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
      
      <!-- Define the Hiro marker -->
      <a-marker preset="kanji" registerevents>
        <!-- Add a cube object on the marker -->
        <a-box position='0 0.5 0' material='color: yellow;'></a-box>
      </a-marker>
      
      <!-- Add a camera -->
      <a-entity camera></a-entity>
    </a-scene>
    
    <script>
      AFRAME.registerComponent('registerevents', {
        init: function () {
          const marker = this.el;

          marker.addEventListener('markerFound', () => {
            console.log('markerFound');
          });

          marker.addEventListener('markerLost', () => {
            console.log('markerLost');
          });

          this.el.sceneEl.addEventListener('click', (e) => {
            // Calculate the touch position in Three.js coordinates
            const touchPoint = new THREE.Vector3(
              ( e.clientX / window.innerWidth ) * 2 - 1,
              -( e.clientY / window.innerHeight ) * 2 + 1,
              0.5 );

            // Add a small sphere at the touch position
            const sphere = document.createElement('a-sphere');
            sphere.setAttribute('radius', 0.1);
            sphere.setAttribute('color', 'red');
            sphere.setAttribute('position', touchPoint);
            marker.appendChild(sphere);
          });
        }
      });
    </script>
  </body>
</html>
